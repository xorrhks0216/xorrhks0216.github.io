<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï†ÑÏÑ∏Í≥Ñ ÏãúÍ≥Ñ</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --background-color: #f5f6fa;
            --text-color: #2c3e50;
            --card-background: #ffffff;
            --hover-shadow: 0 8px 25px rgba(52, 152, 219, 0.15);
            --danger-color: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: linear-gradient(135deg, #f5f6fa 0%, #e9ecef 100%);
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1rem 0;
        }

        h1 {
            color: var(--primary-color);
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .description {
            color: var(--text-color);
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            max-width: 600px;
            margin: 0 auto;
            opacity: 0.8;
        }

        .controls {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .add-button {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .add-button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .add-button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        .api-key-section {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .api-key-input {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 0.9rem;
            width: 200px;
        }

        .api-key-label {
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        .clocks-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            justify-content: center;
        }

        .clock-card {
            background: var(--card-background);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(52, 152, 219, 0.1);
            position: relative;
            min-width: 280px;
            flex: 1 1 300px;
            max-width: 350px;
        }

        .clock-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .clock-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .clock-city {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .clock-timezone {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 0.25rem;
        }

        .menu-button {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #95a5a6;
            padding: 0.25rem;
            line-height: 1;
            transition: all 0.2s ease;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            position: relative;
        }

        .menu-button:hover {
            color: var(--primary-color);
            background: rgba(44, 62, 80, 0.1);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--card-background);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 120px;
            padding: 0.5rem 0;
            margin-top: 0.25rem;
            display: none;
            z-index: 100;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .dropdown-menu.active {
            display: block;
        }

        .dropdown-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .dropdown-item:hover {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }

        .dropdown-item.delete {
            color: var(--danger-color);
        }

        .clock-time {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--secondary-color);
            margin: 1rem 0;
            font-variant-numeric: tabular-nums;
        }

        .clock-date {
            font-size: 1rem;
            color: var(--text-color);
            opacity: 0.7;
            margin-bottom: 1rem;
        }

        .weather-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .weather-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .weather-icon {
            font-size: 2rem;
        }

        .weather-details {
            flex: 1;
        }

        .weather-temp {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .weather-desc {
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .weather-loading {
            color: #95a5a6;
            font-size: 0.9rem;
        }

        .weather-error {
            color: var(--danger-color);
            font-size: 0.9rem;
        }

        /* Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-background);
            border-radius: 15px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #95a5a6;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            color: var(--danger-color);
            background: rgba(231, 76, 60, 0.1);
        }

        .city-search {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .city-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .city-item {
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 0.5rem;
        }

        .city-item:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .city-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .city-name {
            font-weight: 500;
            color: var(--primary-color);
        }

        .city-timezone {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 0.25rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #95a5a6;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-state-text {
            font-size: 1.1rem;
        }

        /* Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
        @media (max-width: 768px) {
            .clocks-container {
                gap: 1rem;
            }

            .clock-card {
                min-width: 100%;
                max-width: 100%;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .api-key-section {
                flex-direction: column;
                align-items: stretch;
            }

            .api-key-input {
                width: 100%;
            }

            .modal-content {
                padding: 1.5rem;
            }
        }

        /* Îã§ÌÅ¨Î™®Îìú ÏßÄÏõê */
        @media (prefers-color-scheme: dark) {
            :root {
                --primary-color: #3498db;
                --secondary-color: #e74c3c;
                --background-color: #1a1a1a;
                --text-color: #ffffff;
                --card-background: #2c2c2c;
            }

            body {
                background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 100%);
            }

            .city-search {
                background: #1a1a1a;
                border-color: #444;
                color: var(--text-color);
            }

            .api-key-input {
                background: #1a1a1a;
                border-color: #444;
                color: var(--text-color);
            }

            .weather-section {
                border-top-color: #444;
            }

            .dropdown-menu {
                background: #2c2c2c;
                border-color: #444;
            }

            .dropdown-item {
                color: var(--text-color);
            }

            .dropdown-item:hover {
                background: rgba(231, 76, 60, 0.2);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Ï†ÑÏÑ∏Í≥Ñ ÏãúÍ≥Ñ</h1>
            <p class="description">ÏõêÌïòÎäî ÎèÑÏãúÎ•º Ï∂îÍ∞ÄÌïòÏó¨ Ï†ÑÏÑ∏Í≥Ñ Ïó¨Îü¨ ÏßÄÏó≠Ïùò ÌòÑÏû¨ ÏãúÍ∞ÑÏùÑ Ìïú Î≤àÏóê ÌôïÏù∏ÌïòÏÑ∏Ïöî.</p>
        </header>

        <div class="controls">
            <button class="add-button" id="addButton">
                <span>+</span>
                <span>ÎèÑÏãú Ï∂îÍ∞Ä</span>
            </button>
            <div class="api-key-section">
                <label class="api-key-label" for="apiKeyInput">ÎÇ†Ïî® API ÌÇ§:</label>
                <input type="text" class="api-key-input" id="apiKeyInput" placeholder="OpenWeatherMap API ÌÇ§ (ÏÑ†ÌÉùÏÇ¨Ìï≠)">
            </div>
        </div>

        <div class="clocks-container" id="clocksContainer">
            <div class="empty-state" id="emptyState">
                <div class="empty-state-icon">üïê</div>
                <div class="empty-state-text">ÎèÑÏãúÎ•º Ï∂îÍ∞ÄÌïòÏó¨ ÏãúÍ≥ÑÎ•º ÏãúÏûëÌïòÏÑ∏Ïöî</div>
            </div>
        </div>
    </div>

    <!-- ÎèÑÏãú ÏÑ†ÌÉù Î™®Îã¨ -->
    <div class="modal" id="cityModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ÎèÑÏãú ÏÑ†ÌÉù</h2>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <input type="text" class="city-search" id="citySearch" placeholder="ÎèÑÏãú Í≤ÄÏÉâ...">
            <div class="city-list" id="cityList"></div>
        </div>
    </div>

    <script>
        // Ï£ºÏöî ÎèÑÏãú Î™©Î°ù (ÎèÑÏãúÎ™Ö, ÌÉÄÏûÑÏ°¥, ÏúÑÎèÑ, Í≤ΩÎèÑ)
        const cities = [
            { name: 'ÏÑúÏö∏', timezone: 'Asia/Seoul', lat: 37.5665, lon: 126.9780 },
            { name: 'ÎèÑÏøÑ', timezone: 'Asia/Tokyo', lat: 35.6762, lon: 139.6503 },
            { name: 'Î≤†Ïù¥Ïßï', timezone: 'Asia/Shanghai', lat: 39.9042, lon: 116.4074 },
            { name: 'ÌôçÏΩ©', timezone: 'Asia/Hong_Kong', lat: 22.3193, lon: 114.1694 },
            { name: 'Ïã±Í∞ÄÌè¨Î•¥', timezone: 'Asia/Singapore', lat: 1.3521, lon: 103.8198 },
            { name: 'Î≠ÑÎ∞îÏù¥', timezone: 'Asia/Kolkata', lat: 19.0760, lon: 72.8777 },
            { name: 'ÎëêÎ∞îÏù¥', timezone: 'Asia/Dubai', lat: 25.2048, lon: 55.2708 },
            { name: 'Î™®Ïä§ÌÅ¨Î∞î', timezone: 'Europe/Moscow', lat: 55.7558, lon: 37.6173 },
            { name: 'Îü∞Îçò', timezone: 'Europe/London', lat: 51.5074, lon: -0.1278 },
            { name: 'ÌååÎ¶¨', timezone: 'Europe/Paris', lat: 48.8566, lon: 2.3522 },
            { name: 'Î≤†Î•ºÎ¶∞', timezone: 'Europe/Berlin', lat: 52.5200, lon: 13.4050 },
            { name: 'Î°úÎßà', timezone: 'Europe/Rome', lat: 41.9028, lon: 12.4964 },
            { name: 'ÎßàÎìúÎ¶¨Îìú', timezone: 'Europe/Madrid', lat: 40.4168, lon: -3.7038 },
            { name: 'ÏïîÏä§ÌÖåÎ•¥Îã¥', timezone: 'Europe/Amsterdam', lat: 52.3676, lon: 4.9041 },
            { name: 'Îâ¥Ïöï', timezone: 'America/New_York', lat: 40.7128, lon: -74.0060 },
            { name: 'Î°úÏä§Ïï§Ï†§Î†àÏä§', timezone: 'America/Los_Angeles', lat: 34.0522, lon: -118.2437 },
            { name: 'ÏãúÏπ¥Í≥†', timezone: 'America/Chicago', lat: 41.8781, lon: -87.6298 },
            { name: 'ÌÜ†Î°†ÌÜ†', timezone: 'America/Toronto', lat: 43.6532, lon: -79.3832 },
            { name: 'Î©ïÏãúÏΩîÏãúÌã∞', timezone: 'America/Mexico_City', lat: 19.4326, lon: -99.1332 },
            { name: 'ÏÉÅÌååÏö∏Î£®', timezone: 'America/Sao_Paulo', lat: -23.5505, lon: -46.6333 },
            { name: 'Î∂ÄÏóêÎÖ∏Ïä§ÏïÑÏù¥Î†àÏä§', timezone: 'America/Argentina/Buenos_Aires', lat: -34.6037, lon: -58.3816 },
            { name: 'ÏãúÎìúÎãà', timezone: 'Australia/Sydney', lat: -33.8688, lon: 151.2093 },
            { name: 'Î©úÎ≤ÑÎ•∏', timezone: 'Australia/Melbourne', lat: -37.8136, lon: 144.9631 },
            { name: 'Ïò§ÌÅ¥ÎûúÎìú', timezone: 'Pacific/Auckland', lat: -36.8485, lon: 174.7633 },
            { name: 'Ìò∏ÎÜÄÎ£∞Î£®', timezone: 'Pacific/Honolulu', lat: 21.3099, lon: -157.8581 },
            { name: 'Ïπ¥Ïù¥Î°ú', timezone: 'Africa/Cairo', lat: 30.0444, lon: 31.2357 },
            { name: 'ÏöîÌïòÎÑ§Ïä§Î≤ÑÍ∑∏', timezone: 'Africa/Johannesburg', lat: -26.2041, lon: 28.0473 },
            { name: 'ÎÇòÏù¥Î°úÎπÑ', timezone: 'Africa/Nairobi', lat: -1.2921, lon: 36.8219 }
        ];

        let selectedCities = [];
        const MAX_CITIES = 8;
        let updateInterval = null;

        // DOM ÏöîÏÜå
        const addButton = document.getElementById('addButton');
        const cityModal = document.getElementById('cityModal');
        const closeModal = document.getElementById('closeModal');
        const citySearch = document.getElementById('citySearch');
        const cityList = document.getElementById('cityList');
        const clocksContainer = document.getElementById('clocksContainer');
        const emptyState = document.getElementById('emptyState');
        const apiKeyInput = document.getElementById('apiKeyInput');

        // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
        function loadData() {
            const saved = localStorage.getItem('worldClocks');
            if (saved) {
                selectedCities = JSON.parse(saved);
                renderClocks();
            }
            const savedApiKey = localStorage.getItem('weatherApiKey');
            if (savedApiKey) {
                apiKeyInput.value = savedApiKey;
            }
        }

        // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        function saveData() {
            localStorage.setItem('worldClocks', JSON.stringify(selectedCities));
        }

        // API ÌÇ§ Ï†ÄÏû•
        apiKeyInput.addEventListener('change', () => {
            localStorage.setItem('weatherApiKey', apiKeyInput.value);
            // Í∏∞Ï°¥ ÏãúÍ≥ÑÎì§Ïùò ÎÇ†Ïî® Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            selectedCities.forEach((city, index) => {
                if (apiKeyInput.value) {
                    fetchWeather(city, index);
                }
            });
        });

        // Î™®Îã¨ Ïó¥Í∏∞
        addButton.addEventListener('click', () => {
            if (selectedCities.length >= MAX_CITIES) {
                alert(`ÏµúÎåÄ ${MAX_CITIES}Í∞úÍπåÏßÄÎßå Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§.`);
                return;
            }
            cityModal.classList.add('active');
            renderCityList();
            citySearch.focus();
        });

        // Î™®Îã¨ Îã´Í∏∞
        closeModal.addEventListener('click', () => {
            cityModal.classList.remove('active');
            citySearch.value = '';
        });

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        cityModal.addEventListener('click', (e) => {
            if (e.target === cityModal) {
                cityModal.classList.remove('active');
                citySearch.value = '';
            }
        });

        // ÎèÑÏãú Í≤ÄÏÉâ
        citySearch.addEventListener('input', () => {
            renderCityList();
        });

        // ÎèÑÏãú Î™©Î°ù Î†åÎçîÎßÅ
        function renderCityList() {
            const searchTerm = citySearch.value.toLowerCase();
            const filteredCities = cities.filter(city => 
                city.name.toLowerCase().includes(searchTerm)
            );

            cityList.innerHTML = '';

            if (filteredCities.length === 0) {
                cityList.innerHTML = '<div style="text-align: center; padding: 2rem; color: #95a5a6;">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }

            filteredCities.forEach(city => {
                const isSelected = selectedCities.some(sc => sc.name === city.name);
                const cityItem = document.createElement('div');
                cityItem.className = `city-item ${isSelected ? 'disabled' : ''}`;
                cityItem.innerHTML = `
                    <div class="city-name">${city.name}</div>
                    <div class="city-timezone">${city.timezone}</div>
                `;
                
                if (!isSelected) {
                    cityItem.addEventListener('click', () => {
                        addCity(city);
                        cityModal.classList.remove('active');
                        citySearch.value = '';
                    });
                }
                
                cityList.appendChild(cityItem);
            });
        }

        // ÎèÑÏãú Ï∂îÍ∞Ä
        function addCity(city) {
            if (selectedCities.length >= MAX_CITIES) {
                alert(`ÏµúÎåÄ ${MAX_CITIES}Í∞úÍπåÏßÄÎßå Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§.`);
                return;
            }

            selectedCities.push({ ...city });
            saveData();
            renderClocks();
            addButton.disabled = selectedCities.length >= MAX_CITIES;
        }

        // ÎèÑÏãú Ï†úÍ±∞
        function removeCity(index) {
            selectedCities.splice(index, 1);
            saveData();
            renderClocks();
            addButton.disabled = selectedCities.length >= MAX_CITIES;
        }

        // ÏãúÍ≥Ñ Î†åÎçîÎßÅ
        function renderClocks() {
            clocksContainer.innerHTML = '';

            if (selectedCities.length === 0) {
                clocksContainer.appendChild(emptyState);
                if (updateInterval) {
                    clearInterval(updateInterval);
                    updateInterval = null;
                }
                return;
            }

            selectedCities.forEach((city, index) => {
                const clockCard = document.createElement('div');
                clockCard.className = 'clock-card';
                clockCard.innerHTML = `
                    <div class="clock-header">
                        <div>
                            <div class="clock-city">${city.name}</div>
                            <div class="clock-timezone">${city.timezone}</div>
                        </div>
                        <div style="position: relative;">
                            <button class="menu-button" data-index="${index}" title="Î©îÎâ¥">‚ãØ</button>
                            <div class="dropdown-menu" id="menu-${index}">
                                <div class="dropdown-item delete" data-action="delete">
                                    <span>üóëÔ∏è</span>
                                    <span>ÏÇ≠Ï†ú</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clock-time" id="time-${index}">--:--:--</div>
                    <div class="clock-date" id="date-${index}">--</div>
                    <div class="weather-section" id="weather-${index}">
                        <div class="weather-loading">ÎÇ†Ïî® Ï†ïÎ≥¥ Î°úÎî© Ï§ë...</div>
                    </div>
                `;
                const menuBtn = clockCard.querySelector('.menu-button');
                const dropdownMenu = clockCard.querySelector('.dropdown-menu');
                const deleteItem = clockCard.querySelector('.dropdown-item.delete');
                
                // Î©îÎâ¥ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú ÎìúÎ°≠Îã§Ïö¥ ÌÜ†Í∏Ä
                menuBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    // Îã§Î•∏ Î©îÎâ¥ Îã´Í∏∞
                    document.querySelectorAll('.dropdown-menu').forEach(menu => {
                        if (menu !== dropdownMenu) {
                            menu.classList.remove('active');
                        }
                    });
                    dropdownMenu.classList.toggle('active');
                });
                
                // ÏÇ≠Ï†ú Ìï≠Î™© ÌÅ¥Î¶≠
                deleteItem.addEventListener('click', (e) => {
                    e.stopPropagation();
                    removeCity(index);
                    dropdownMenu.classList.remove('active');
                });
                
                clocksContainer.appendChild(clockCard);
            });
            
            // Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Î©îÎâ¥ Îã´Í∏∞
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.menu-button') && !e.target.closest('.dropdown-menu')) {
                    document.querySelectorAll('.dropdown-menu').forEach(menu => {
                        menu.classList.remove('active');
                    });
                }
            });

            updateAllClocks();
            if (!updateInterval) {
                updateInterval = setInterval(updateAllClocks, 1000);
            }

            // ÎÇ†Ïî® Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
            selectedCities.forEach((city, index) => {
                if (apiKeyInput.value) {
                    fetchWeather(city, index);
                } else {
                    const weatherEl = document.getElementById(`weather-${index}`);
                    weatherEl.innerHTML = '<div class="weather-error">ÎÇ†Ïî® API ÌÇ§Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî</div>';
                }
            });
        }

        // Î™®Îì† ÏãúÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateAllClocks() {
            selectedCities.forEach((city, index) => {
                updateClock(city, index);
            });
        }

        // Í∞úÎ≥Ñ ÏãúÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateClock(city, index) {
            try {
                const now = new Date();
                const timeString = now.toLocaleTimeString('ko-KR', {
                    timeZone: city.timezone,
                    hour12: false,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                const dateString = now.toLocaleDateString('ko-KR', {
                    timeZone: city.timezone,
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'long'
                });

                const timeEl = document.getElementById(`time-${index}`);
                const dateEl = document.getElementById(`date-${index}`);
                
                if (timeEl) timeEl.textContent = timeString;
                if (dateEl) dateEl.textContent = dateString;
            } catch (error) {
                console.error(`ÏãúÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏ Ïò§Î•ò (${city.name}):`, error);
            }
        }

        // ÎÇ†Ïî® Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
        async function fetchWeather(city, index) {
            const apiKey = apiKeyInput.value;
            if (!apiKey) return;

            const weatherEl = document.getElementById(`weather-${index}`);
            if (!weatherEl) return;

            try {
                weatherEl.innerHTML = '<div class="weather-loading">ÎÇ†Ïî® Ï†ïÎ≥¥ Î°úÎî© Ï§ë...</div>';
                
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${city.lat}&lon=${city.lon}&appid=${apiKey}&units=metric&lang=kr`
                );

                if (!response.ok) {
                    throw new Error('ÎÇ†Ïî® Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                }

                const data = await response.json();
                
                const weatherIcon = getWeatherIcon(data.weather[0].main);
                weatherEl.innerHTML = `
                    <div class="weather-info">
                        <div class="weather-icon">${weatherIcon}</div>
                        <div class="weather-details">
                            <div class="weather-temp">${Math.round(data.main.temp)}¬∞C</div>
                            <div class="weather-desc">${data.weather[0].description}</div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('ÎÇ†Ïî® Ï†ïÎ≥¥ Ïò§Î•ò:', error);
                weatherEl.innerHTML = '<div class="weather-error">ÎÇ†Ïî® Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§</div>';
            }
        }

        // ÎÇ†Ïî® ÏïÑÏù¥ÏΩò Îß§Ìïë
        function getWeatherIcon(weatherMain) {
            const iconMap = {
                'Clear': '‚òÄÔ∏è',
                'Clouds': '‚òÅÔ∏è',
                'Rain': 'üåßÔ∏è',
                'Drizzle': 'üå¶Ô∏è',
                'Thunderstorm': '‚õàÔ∏è',
                'Snow': '‚ùÑÔ∏è',
                'Mist': 'üå´Ô∏è',
                'Fog': 'üå´Ô∏è',
                'Haze': 'üå´Ô∏è'
            };
            return iconMap[weatherMain] || 'üå§Ô∏è';
        }

        // Ï¥àÍ∏∞Ìôî
        loadData();
        addButton.disabled = selectedCities.length >= MAX_CITIES;
    </script>
</body>
</html>
